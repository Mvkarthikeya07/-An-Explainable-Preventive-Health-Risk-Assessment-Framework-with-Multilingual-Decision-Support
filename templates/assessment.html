<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ t.title }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

<div class="container">
    <h2>{{ t.title }}</h2>

    <form action="/result" method="POST">

        <!-- AGE -->
        <label>{{ t.age }}</label>
        <div>
            <input type="number" id="age" name="age" placeholder="{{ t.age }}" required>
            <button type="button" onclick="listenNumber('age','age')">üé§</button>
        </div>

        <!-- BMI -->
        <label>{{ t.bmi }}</label>
        <div>
            <input type="number" step="0.1" id="bmi" name="bmi" placeholder="{{ t.bmi }}" required>
            <button type="button" onclick="listenNumber('bmi','bmi')">üé§</button>
        </div>

        <!-- BP -->
        <label>{{ t.bp }}</label>
        <div>
            <input type="number" id="bp" name="bp" placeholder="{{ t.bp }}" required>
            <button type="button" onclick="listenNumber('bp','bp')">üé§</button>
        </div>

        <!-- SUGAR -->
        <label>{{ t.sugar }}</label>
        <div>
            <input type="number" id="sugar" name="sugar" placeholder="{{ t.sugar }}" required>
            <button type="button" onclick="listenNumber('sugar','sugar')">üé§</button>
        </div>

        <!-- SMOKING -->
        <label>{{ t.smoking }}</label>
        <select id="smoking" name="smoking">
            <option value="no">{{ t.no }}</option>
            <option value="yes">{{ t.yes }}</option>
        </select>
        <button type="button" onclick="listenChoice('smoking','smoking')">üé§</button>

        <!-- ACTIVITY -->
        <label>{{ t.activity }}</label>
        <select id="activity" name="activity">
            <option value="high">{{ t.high }}</option>
            <option value="medium">{{ t.medium }}</option>
            <option value="low">{{ t.low }}</option>
        </select>
        <button type="button" onclick="listenChoice('activity','activity')">üé§</button>

        <button type="submit">{{ t.analyze }}</button>
    </form>

    <p class="disclaimer">{{ t.disclaimer }}</p>
</div>

<script>
/* ================= LANGUAGE ================= */
const lang = "{{ session.get('lang','en') }}";

/* ================= VOICE PROMPTS ================= */
const voicePrompts = {
    en: {
        age: "Please say your age",
        bmi: "Please say your BMI",
        bp: "Please say your blood pressure",
        sugar: "Please say your blood sugar level",
        smoking: "Please say yes or no for smoking",
        activity: "Please say high, moderate, or low physical activity",
        entered: v => `Entered ${v}`
    },
    hi: {
        age: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡•Ä ‡§â‡§Æ‡•ç‡§∞ ‡§¨‡§§‡§æ‡§è‡§Ç",
        bmi: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡§æ ‡§¨‡•Ä‡§è‡§Æ‡§Ü‡§à ‡§¨‡§§‡§æ‡§è‡§Ç",
        bp: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡§æ ‡§∞‡§ï‡•ç‡§§‡§ö‡§æ‡§™ ‡§¨‡§§‡§æ‡§è‡§Ç",
        sugar: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡§æ ‡§¨‡•ç‡§≤‡§° ‡§∂‡•Å‡§ó‡§∞ ‡§¨‡§§‡§æ‡§è‡§Ç",
        smoking: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§ß‡•Ç‡§Æ‡•ç‡§∞‡§™‡§æ‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§π‡§æ‡§Å ‡§Ø‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§π‡•á‡§Ç",
        activity: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§â‡§ö‡•ç‡§ö, ‡§Æ‡§ß‡•ç‡§Ø‡§Æ ‡§Ø‡§æ ‡§ï‡§Æ ‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø ‡§¨‡§§‡§æ‡§è‡§Ç",
        entered: v => `${v} ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ`
    },
    te: {
        age: "‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞Æ‡±Ä ‡∞µ‡∞Ø‡∞∏‡±ç‡∞∏‡±Å ‡∞ö‡±Ü‡∞™‡±ç‡∞™‡∞Ç‡∞°‡∞ø",
        bmi: "‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞Æ‡±Ä ‡∞¨‡±Ä‡∞é‡∞Ç‡∞ê ‡∞ö‡±Ü‡∞™‡±ç‡∞™‡∞Ç‡∞°‡∞ø",
        bp: "‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞Æ‡±Ä ‡∞∞‡∞ï‡±ç‡∞§‡∞™‡±ã‡∞ü‡±Å ‡∞ö‡±Ü‡∞™‡±ç‡∞™‡∞Ç‡∞°‡∞ø",
        sugar: "‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞Æ‡±Ä ‡∞∞‡∞ï‡±ç‡∞§‡∞Ç‡∞≤‡±ã ‡∞ö‡∞ï‡±ç‡∞ï‡±Ü‡∞∞ ‡∞ö‡±Ü‡∞™‡±ç‡∞™‡∞Ç‡∞°‡∞ø",
        smoking: "‡∞™‡±ä‡∞ó ‡∞§‡±ç‡∞∞‡∞æ‡∞ó‡±Å‡∞§‡∞æ‡∞∞‡∞æ ‡∞ö‡±Ü‡∞™‡±ç‡∞™‡∞Ç‡∞°‡∞ø",
        activity: "‡∞é‡∞ï‡±ç‡∞ï‡±Å‡∞µ, ‡∞Æ‡∞ß‡±ç‡∞Ø‡∞∏‡±ç‡∞• ‡∞≤‡±á‡∞¶‡∞æ ‡∞§‡∞ï‡±ç‡∞ï‡±Å‡∞µ ‡∞ö‡±Å‡∞∞‡±Å‡∞ï‡±Å‡∞¶‡∞®‡∞Ç ‡∞ö‡±Ü‡∞™‡±ç‡∞™‡∞Ç‡∞°‡∞ø",
        entered: v => `${v} ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø`
    },
    ta: {
        age: "‡Æ§‡ÆØ‡Æµ‡ØÅ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡ØÅ ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æµ‡ÆØ‡Æ§‡Øà ‡Æö‡Øä‡Æ≤‡Øç‡Æ≤‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç",
        bmi: "‡Æ§‡ÆØ‡Æµ‡ØÅ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡ØÅ ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ™‡Æø‡Æé‡ÆÆ‡Øç‡Æê ‡Æö‡Øä‡Æ≤‡Øç‡Æ≤‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç",
        bp: "‡Æ§‡ÆØ‡Æµ‡ØÅ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡ØÅ ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æá‡Æ∞‡Æ§‡Øç‡Æ§ ‡ÆÖ‡Æ¥‡ØÅ‡Æ§‡Øç‡Æ§‡Æ§‡Øç‡Æ§‡Øà ‡Æö‡Øä‡Æ≤‡Øç‡Æ≤‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç",
        sugar: "‡Æ§‡ÆØ‡Æµ‡ØÅ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡ØÅ ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æá‡Æ∞‡Æ§‡Øç‡Æ§ ‡Æö‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æ∞‡Øà‡ÆØ‡Øà ‡Æö‡Øä‡Æ≤‡Øç‡Æ≤‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç",
        smoking: "‡Æ™‡ØÅ‡Æï‡Øà‡Æ™‡Æø‡Æü‡Æø‡Æ™‡Øç‡Æ™‡Æ§‡ØÅ ‡ÆÜ‡ÆÆ‡Øç ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡Æá‡Æ≤‡Øç‡Æ≤‡Øà ‡Æö‡Øä‡Æ≤‡Øç‡Æ≤‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç",
        activity: "‡Æâ‡ÆØ‡Æ∞‡Øç, ‡ÆÆ‡Æø‡Æ§‡ÆÆ‡Ææ‡Æ© ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡Æï‡ØÅ‡Æ±‡Øà‡Æ®‡Øç‡Æ§ ‡Æâ‡Æü‡Æ±‡Øç‡Æ™‡ÆØ‡Æø‡Æ±‡Øç‡Æö‡Æø ‡Æö‡Øä‡Æ≤‡Øç‡Æ≤‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç",
        entered: v => `${v} ‡Æ™‡Æ§‡Æø‡Æµ‡ØÅ ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ`
    },
    ml: {
        age: "‡¥¶‡¥Ø‡¥µ‡¥æ‡¥Ø‡¥ø ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥™‡µç‡¥∞‡¥æ‡¥Ø‡¥Ç ‡¥™‡¥±‡¥Ø‡µÅ‡¥ï",
        bmi: "‡¥¶‡¥Ø‡¥µ‡¥æ‡¥Ø‡¥ø ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥¨‡¥ø‡¥é‡¥Ç‡¥ê ‡¥™‡¥±‡¥Ø‡µÅ‡¥ï",
        bp: "‡¥¶‡¥Ø‡¥µ‡¥æ‡¥Ø‡¥ø ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥∞‡¥ï‡µç‡¥§‡¥∏‡¥Æ‡µç‡¥Æ‡µº‡¥¶‡µç‡¥¶‡¥Ç ‡¥™‡¥±‡¥Ø‡µÅ‡¥ï",
        sugar: "‡¥¶‡¥Ø‡¥µ‡¥æ‡¥Ø‡¥ø ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥¨‡µç‡¥≤‡¥°‡µç ‡¥∑‡µÅ‡¥ó‡µº ‡¥™‡¥±‡¥Ø‡µÅ‡¥ï",
        smoking: "‡¥™‡µÅ‡¥ï‡¥µ‡¥≤‡¥ø ‡¥â‡¥£‡µç‡¥ü‡µã ‡¥é‡¥®‡µç‡¥®‡µç ‡¥™‡¥±‡¥Ø‡µÅ‡¥ï",
        activity: "‡¥â‡¥Ø‡µº‡¥®‡µç‡¥®, ‡¥Æ‡¥ø‡¥§‡¥Æ‡¥æ‡¥Ø ‡¥Ö‡¥≤‡µç‡¥≤‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ ‡¥ï‡µÅ‡¥±‡¥û‡µç‡¥û ‡¥™‡µç‡¥∞‡¥µ‡µº‡¥§‡µç‡¥§‡¥®‡¥Ç ‡¥™‡¥±‡¥Ø‡µÅ‡¥ï",
        entered: v => `${v} ‡¥®‡µΩ‡¥ï‡¥™‡µç‡¥™‡µÜ‡¥ü‡µç‡¥ü‡µÅ`
    }
};

/* ================= SPEAK ================= */
function speak(text) {
    const u = new SpeechSynthesisUtterance(text);
    u.lang = lang + "-IN";
    speechSynthesis.cancel();
    speechSynthesis.speak(u);
}

const SpeechRecognition =
    window.SpeechRecognition || window.webkitSpeechRecognition;

/* ================= NUMBER INPUT ================= */
function listenNumber(fieldId, key) {
    speak(voicePrompts[lang][key]);

    const rec = new SpeechRecognition();
    rec.lang = lang + "-IN";
    rec.start();

    rec.onresult = e => {
        const spoken = e.results[0][0].transcript;
        const num = spoken.match(/\d+(\.\d+)?/);
        if (num) {
            document.getElementById(fieldId).value = num[0];
            speak(voicePrompts[lang].entered(num[0]));
        }
    };
}

/* ================= CHOICE INPUT ================= */
function listenChoice(fieldId, key) {
    speak(voicePrompts[lang][key]);

    const rec = new SpeechRecognition();
    rec.lang = lang + "-IN";
    rec.start();

    rec.onresult = e => {
        const spoken = e.results[0][0].transcript.toLowerCase();

        /* SMOKING */
        if (key === "smoking") {
            if (
                spoken.includes("yes") ||
                spoken.includes("‡§π‡§æ‡§Å") ||
                spoken.includes("‡∞Ö‡∞µ‡±Å‡∞®‡±Å") ||
                spoken.includes("‡ÆÜ‡ÆÆ‡Øç") ||
                spoken.includes("‡¥Ö‡¥§‡µÜ")
            ) {
                document.getElementById(fieldId).value = "yes";
                speak(voicePrompts[lang].entered("yes"));
            } else {
                document.getElementById(fieldId).value = "no";
                speak(voicePrompts[lang].entered("no"));
            }
            return;
        }

        /* ACTIVITY */
        if (key === "activity") {

            if (
                spoken.includes("high") ||
                spoken.includes("active") ||
                spoken.includes("‡∞é‡∞ï‡±ç‡∞ï‡±Å‡∞µ") ||
                spoken.includes("‡Æâ‡ÆØ‡Æ∞‡Øç") ||
                spoken.includes("‡¥∏‡¥ú‡µÄ‡¥µ")
            ) {
                document.getElementById(fieldId).value = "high";
                speak("Entered high physical activity");
                return;
            }

            if (
                spoken.includes("moderate") ||
                spoken.includes("medium") ||
                spoken.includes("‡∞Æ‡∞ß‡±ç‡∞Ø") ||
                spoken.includes("‡ÆÆ‡Æø‡Æ§") ||
                spoken.includes("‡¥Æ‡¥ø‡¥§")
            ) {
                document.getElementById(fieldId).value = "medium";
                speak("Entered moderate physical activity");
                return;
            }

            if (
                spoken.includes("low") ||
                spoken.includes("less") ||
                spoken.includes("‡∞§‡∞ï‡±ç‡∞ï‡±Å‡∞µ") ||
                spoken.includes("‡Æï‡ØÅ‡Æ±‡Øà") ||
                spoken.includes("‡¥ï‡µÅ‡¥±‡¥µ‡µç")
            ) {
                document.getElementById(fieldId).value = "low";
                speak("Entered low physical activity");
                return;
            }

            speak("Sorry, I could not understand your activity level");
        }
    };
}
</script>

</body>
</html>


